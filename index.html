<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="initial-scale=1,maximum-scale=1,user-scalable=no"
    />

    <title>
     ODS España
    </title>

    <style>
      html,
      body {
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
        background: rgba(50, 50, 50);
      }
      .myPopup{
      z-index: 2;
      position: fixed;
      overflow: auto;
      align-items: center;
      right: 700px;
      top:300px;
      width: 45%;
      height: 50%;
      background: #cfc4c409;
      
    }
     
    .flex-container {
      height: 100%;
      display: flex;
      z-index: 1;
      background-color: #fcf9f9;
     
    }

    #viewDiv {
      flex: 2;
      padding: 0;
      margin: 0;
      z-index: 2;
    }

    .side-panel {
      flex: 1;
      padding: 1em;
    
      height: 50%;
      width: 50%;
    }

    .container {
      border-bottom: solid 1px rgb(209, 99, 99);
    }

    h3 {
      color: #ffa500;
    }

    .esri-feature__title {
      background-color: #faf6f61a;
      padding: 0.25em;
    }

    .esri-feature__size-container {
      background: #f7f4f400;
    }
    #imgLogo{
     
      margin-top: -80px;
      margin-left: 70px;
      z-index: 5;
      background-color: #faf8f800;
      
      
    }
    .ods1{
    z-index: 5;
    margin-top: -500px;
    margin-right: -2700px;
    right: 2750px;
    background-color:rgba(0, 139, 174, 0.5);
    color: rgb(244, 246, 248);
    position: absolute;
    border: 1px solid #616060;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    font-family: 'Arial';
    text-align: center;
    cursor: pointer;
    width: 80px;
    
}
.ods{
  z-index: 5;
    margin-top: -349px;
    margin-right: -1675px;
    right: 2750px;
    background-color:rgba(44, 46, 46, 0.062);
    color: rgb(244, 246, 248);
    position: absolute;
    font-size:15px ;
    font-family: 'Arial';
    text-align: center;

}
    </style>
    <script >
      var app={};
      var miCallback= datos=>{
      console.log(datos);
      app.itemI= datos;
      
      }
      </script>


    <link
      rel="stylesheet"
      href="https://js.arcgis.com/4.18/esri/themes/dark-blue/main.css"
    />
    <script src="https://js.arcgis.com/4.18/"></script>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script> -->
    <!-- <script src="p.js"></script> -->
    <script src="itemI.json"></script>
    <script>
      require([
      "esri/Map",
      "esri/layers/FeatureLayer",
      "esri/layers/GeoJSONLayer",
      "esri/views/MapView",
      "esri/widgets/Home",
      "esri/core/Handles"
  
    ], function (
      Map,
      FeatureLayer,
      GeoJSONLayer,
      MapView,
      Home,
      Handles,
    
    ) {
  
      let handles = new Handles();
  
      handles.remove(); // removes handles from default group
      
      handles.remove("layer");
      const layer = new GeoJSONLayer({
        title: "Earthquakes from the last month",
        url:
          "https://raw.githubusercontent.com/dani898908/modulo2_keepcoding/main/nuevo.geojson",
        copyright: "ODS Ciudades de España",
        outFields: ['*'],
        popupTemplate: {
          title: "{name}",
          lastEditInfoEnabled: false,
        
        },
        renderer: {
          type: "simple",
          field: "NOMBRE",
          symbol: {
            type: "simple-marker",
            size: 5,
            color: "#69dcff",
            outline: {
              color: "rgba(0, 139, 174, 0.5)",
              width: 5
            }
          }
        },
        popupTemplate: {
          title: " Informe cumplimiento ODS {NOMBRE}",
          outFields: ['*'],
          actions: [
            {
              id: "find-brewery",
              image:
                "https://raw.githubusercontent.com/UNStats-SDGs/sdgs-data/master/images/en/TGG_Icon_Color_3.png",
              title: "Más Info"
            }
          ],
          content: [ 
            {
              type: "fields",
              fieldInfos: [
                {
                  fieldName: "Ods_1",
                  label: "No Poverty"
                },
                {
                  fieldName: "Ods_2",
                  label: "Zero Hunger"
                },
                {
                  fieldName: "Ods_3",
                  label: "Good Health and Well-being"
                },
                {
                  fieldName: "Ods_4",
                  label: "Quality Education"
                },
                {
                  fieldName: "Ods_5",
                  label: "Gender Equality"
                },
                {
                  fieldName: "Ods_6",
                  label: "Clean Water and Sanitation"
                }
              ]
            }
          ],cambiar
        },
        visible: true,
      });
      window.onload= function (){
        document.getElementById("ruta").addEventListener("click",cambiar);
       
      }
    
      function cambiar(feature){
       if(layer.visible === true){
         return layer.visible = false;
       }else{
         return layer.visible= true;
       }
        
      }
      const baseLayer = new FeatureLayer({
        portalItem: {
          id: "2b93b06dc0dc4e809d3c8db5cb96ba69"
        },
        legendEnabled: false,
        popupEnabled: false,
        renderer: {
          type: "simple",
          symbol: {
            type: "simple-fill",
            color: [65, 65, 65, 1],
            outline: {
              color: [50, 50, 50, 0.75],
              width: 1
            }
          }
        }
      });
      const map = new Map({
          basemap: "dark-gray-vector",
        layers: [  baseLayer,layer]
      });
  
      const view = new MapView({
        container: "viewDiv",
        zoom: 4.8,
        center: [-15.7254,38.5302], 
        map: map,
        highlightOptions: {
          color: "orange"
        }
      });
      view.ui.add("imgLogo", "top-left");
    
      view.when().then(function () {
        view.on("click", function (event) {
            // Remove any existing highlighted features
            handles.removeAll();
            const featureContainer = document.getElementById("features");
           
            // Clears the parent div's content
            app.itemI.map(item=>{
            featureContainer.innerHTML += "<img height='50px'src='"+item.img+"'></img>";
            for (var clave of Object.keys(item)){
              featureContainer.innerHTML+="<ol>"+item[clave]+"</ol>";
              }
                })
          
        });
      });
    
  
    });
        </script>
  </head>

  <body>
    <div class="flex-container">
        <div id="viewDiv"></div>
      
  </div>
 
  <div class="myPopup"> 
      <div class="myPopup" class="esri-widget side-panel">
         <div class="myPopup" id="features" class="feature-container"> </div>
         <div class="myPopup" id="resultado" class="feature-container"> </div>
         <div   id="imgLogo" class="esri-widget"><img src="http://mexico.makesense.org/wp-content/uploads/2019/10/ods_circulo-ch-25oi37-300x293.png" height="250px" alt=""></div>
      </div>
    </div>
   <button type= 'button'  id="ruta" class='ods1'>Desactivar Ciudades</button>
  <h1 class="ods">Grado de cumplimiento del ODS </h1>
  </body>
</html>
